<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>For You ‚Äî Sunset</title>
<style>
  :root { --accent:#ff6666; --sun-glow: rgba(255,126,95,0.4); }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#ffaf7b,#ff7b7b,#7b4397);-webkit-font-smoothing:antialiased}
  /* Sun */
  .sun{position:absolute;top:-50px;left:-50px;width:260px;height:260px;border-radius:50%;
    background:radial-gradient(circle,#ff5533 0%,#ff7e5f 50%,rgba(255,126,95,0) 70%);
    filter:blur(20px);box-shadow:0 0 120px 40px var(--sun-glow);z-index:0;cursor:pointer}
  /* petals/hearts/tree/land simplified styles (kept from previous version) */
  .petal-wrap{position:absolute;top:0;left:0;pointer-events:auto}
  .petal{display:inline-block;user-select:none;cursor:pointer}
  .heart{position:absolute;cursor:pointer;user-select:none}
  .land{position:absolute;bottom:-40px;left:0;width:120%;height:200px;background:linear-gradient(to bottom,#3d1f1f 0%,#1a0f0f 80%);border-top-left-radius:50% 100px;border-top-right-radius:50% 100px;transform:translateX(-10%);z-index:5;box-shadow:0 -15px 25px rgba(0,0,0,0.4) inset}
  .tree-scene{position:absolute;bottom:100px;right:0;width:280px;height:280px;z-index:6;cursor:pointer}
  svg{width:100%;height:100%;fill:#1a0f16}
  /* messages */
  .message{position:absolute;background:rgba(255,255,255,0.95);padding:8px 14px;border-radius:14px;font-weight:600;font-size:1rem;opacity:0;transform:translateY(12px) scale(.98);animation:floatFade 4s ease forwards;z-index:12;pointer-events:none;white-space:nowrap}
  @keyframes floatFade{0%{opacity:0;transform:translateY(12px) scale(.98)}10%{opacity:1;transform:translateY(0) scale(1)}70%{opacity:1;transform:translateY(-18px)}100%{opacity:0;transform:translateY(-50px)}}
  /* mini player (no cover) */
  #miniPlayer{position:fixed;right:18px;bottom:18px;width:320px;max-width:92%;background:rgba(0,0,0,0.35);padding:12px;border-radius:12px;color:#fff;z-index:9999;backdrop-filter:blur(6px);box-shadow:0 10px 30px rgba(0,0,0,0.5)}
  #mpControls{overflow:hidden}
  .mp-title{font-weight:700;font-size:14px;margin-bottom:6px}
  .mp-buttons{display:flex;gap:8px;align-items:center;margin-bottom:8px}
  .mp-buttons button{background:var(--accent);border:none;color:#fff;padding:6px 8px;border-radius:8px;cursor:pointer}
  #mpProgress, #mpVolume{width:100%;accent-color:var(--accent);background:transparent}
  #mpTime{font-size:12px;color:#ffdede;margin-top:6px;text-align:right}
  @media (max-width:380px){#miniPlayer{width:92%;right:4%;bottom:12px}}
</style>
</head>
<body>

<!-- SUN -->
<div class="sun" id="sun" title="Click the sun"></div>

<!-- petals & hearts & tree (kept minimal ‚Äî existing JS populates) -->
<div class="land" aria-hidden="true"></div>
<div class="tree-scene" id="treeScene" role="button" aria-label="Tree with swing (clickable)">
  <svg viewBox="0 0 300 300" aria-hidden="true">
    <path d="M230 300 L250 160 L270 300 Z" fill="#1a0f16"/>
    <g class="tree-top">
      <circle cx="250" cy="140" r="60"/>
      <circle cx="220" cy="120" r="50"/>
      <circle cx="280" cy="120" r="50"/>
      <g class="branch-sway">
        <circle cx="245" cy="100" r="14"/>
        <circle cx="215" cy="95" r="10"/>
        <circle cx="275" cy="95" r="11"/>
      </g>
    </g>
    <path d="M200 150 C210 140, 240 135, 260 145" stroke="#1a0f16" stroke-width="6" fill="none" stroke-linecap="round"/>
    <line x1="200" y1="150" x2="200" y2="230" stroke="#1a0f16" stroke-width="3"/>
    <line x1="220" y1="150" x2="220" y2="230" stroke="#1a0f16" stroke-width="3"/>
    <g class="swing">
      <rect x="190" y="230" width="40" height="6" fill="#1a0f16"/>
      <circle cx="200" cy="220" r="6" fill="#1a0f16"/>
      <circle cx="215" cy="220" r="6" fill="#1a0f16"/>
    </g>
  </svg>
</div>

<!-- mini player (NO cover) -->
<div id="miniPlayer" aria-label="Music player">
  <div id="mpControls">
    <div class="mp-title" id="mpTitle">Now playing ‚Äî (YouTube)</div>
    <div class="mp-buttons">
      <button id="mpPlay">‚ñ∂Ô∏è</button>
      <button id="mpRew" title="Rewind 10s">‚è™</button>
      <button id="mpFwd" title="Forward 10s">‚è©</button>
    </div>
    <input type="range" id="mpProgress" min="0" max="100" value="0" aria-label="Progress">
    <div id="mpTime">0:00 / 0:00</div>
    <div style="margin-top:8px;">
      <label style="font-size:12px;color:#ffdede">Volume</label>
      <input type="range" id="mpVolume" min="0" max="1" step="0.01" value="0.6" aria-label="Volume">
    </div>
  </div>
</div>

<!-- hidden container where YT player will be inserted -->
<div id="yt-player-container" style="position:fixed;right:-9999px;bottom:-9999px;width:1px;height:1px;overflow:hidden;pointer-events:none;"></div>

<script>
/* ---------------- scene: petals/hearts (same as before) ---------------- */
(function(){
  // create petals
  const numPetals = 30;
  for (let i=0;i<numPetals;i++){
    const wrap = document.createElement('div');
    wrap.className = 'petal-wrap';
    const depth = Math.ceil(Math.random()*3);
    const size = depth===1 ? Math.random()*20 + 24 : depth===2 ? Math.random()*18 + 16 : Math.random()*14 + 10;
    const fallDuration = depth===1 ? Math.random()*5 + 7 : depth===2 ? Math.random()*7 + 9 : Math.random()*9 + 11;
    wrap.style.left = Math.random()*100+'vw';
    wrap.style.top = Math.random()*-200+'px';
    wrap.style.animation = `fallDown ${fallDuration}s linear infinite ${Math.random()*5}s`;
    wrap.style.zIndex = depth===1 ? 9 : depth===2 ? 7 : 5;
    wrap.style.opacity = depth===1 ? 0.95 : depth===2 ? 0.75 : 0.5;
    const petal = document.createElement('div');
    petal.className = 'petal';
    petal.textContent = 'üå∏';
    petal.style.fontSize = size+'px';
    wrap.appendChild(petal);
    document.body.appendChild(wrap);
  }
  // hearts spawn
  function createHeart(){ const h=document.createElement('div'); h.className='heart'; h.textContent='üíó'; h.style.left=(20+Math.random()*60)+'vw'; h.style.top=(20+Math.random()*60)+'vh'; h.style.fontSize=(Math.random()*20+12)+'px'; document.body.appendChild(h); setTimeout(()=>h.remove(),2000); }
  setInterval(createHeart,700);
})();

/* ---------------- click messages: petals, hearts, tree, sun ---------------- */
(function(){
  const treeScene = document.getElementById('treeScene');
  treeScene.addEventListener('click',(e)=>{ e.stopPropagation(); showMsg("Us swinging one day! ü©µ", {right:60,bottom:330, color:'#003366', glow:'0 0 25px rgba(150,200,255,0.6)'}); });

  document.addEventListener('click', (e)=> {
    // petal click
    const petalWrap = e.target.closest('.petal-wrap');
    if (petalWrap && e.target.classList.contains('petal')) {
      e.stopPropagation();
      const pastelColors = ['#ffb6c1','#ffc8dd','#cdb4db','#bde0fe','#a2d2ff','#fbc4ab','#ffafcc','#c8b6ff','#b5ead7','#fdfd96'];
      const color = pastelColors[Math.floor(Math.random()*pastelColors.length)];
      showMsg("You're cute as this flower :3", {color, box:`0 0 25px ${color}80`, anchorRect: petalWrap.getBoundingClientRect()});
      return;
    }
    // heart click
    if (e.target.classList.contains('heart')) {
      e.stopPropagation();
      const texts = ["You stole my heart ‚ô•Ô∏è","I love you üíù"];
      const glowColors = ['#ff66b2','#ff1493','#ff3366','#ff6f91','#ff85a1','#ff3f6e'];
      const text = texts[Math.floor(Math.random()*texts.length)];
      const glow = glowColors[Math.floor(Math.random()*glowColors.length)];
      showMsg(text, {color:glow, box:`0 0 30px ${glow}a0`, anchorRect: e.target.getBoundingClientRect()});
      return;
    }
  });

  // sun click message
  const sun = document.getElementById('sun');
  sun.addEventListener('click', (e)=>{
    e.stopPropagation();
    showMsg("Whoa, someone turned up the heat! ü•µ‚òÄÔ∏è", {color:'#ff3f6e', box:'0 0 30px rgba(255,90,120,0.6)', near: sun.getBoundingClientRect()});
  });

  function showMsg(text, opts={}){
    const msg = document.createElement('div');
    msg.className = 'message';
    msg.textContent = text;
    if (opts.color) msg.style.color = opts.color;
    if (opts.box) msg.style.boxShadow = opts.box;
    if (opts.right!==undefined && opts.bottom!==undefined){ msg.style.right = opts.right+'px'; msg.style.bottom = opts.bottom+'px'; }
    else if (opts.anchorRect) {
      const rect = opts.anchorRect;
      const left = rect.left + rect.width/2 - 80;
      const top = rect.top - 48;
      msg.style.left = Math.max(8, Math.min(left, window.innerWidth - 160)) + 'px';
      msg.style.top = Math.max(8, top) + 'px';
    } else if (opts.near) {
      const rect = opts.near;
      const left = rect.right + 8;
      const top = rect.top + rect.height/2 - 12;
      msg.style.left = Math.max(8, Math.min(left, window.innerWidth - 200)) + 'px';
      msg.style.top = Math.max(8, Math.min(top, window.innerHeight - 80)) + 'px';
    } else {
      msg.style.left = '20px';
      msg.style.top = '20px';
    }
    document.body.appendChild(msg);
    setTimeout(()=>msg.remove(),4200);
  }
})();

/* ---------------- YouTube music player (init after first click) ----------------
   - Replaces separate audio file usage.
   - Uses YouTube IFrame API, but the API + iframe are only loaded on first click.
   - The mini-player controls call player methods (playVideo, pauseVideo, seekTo, setVolume).
   - VIDEO_ID variable: set to the desired YouTube video id (example below).
--------------------------------------------------------------------- */
(function(){
  // **CHANGE THIS** to whichever YouTube video ID you want (e.g. Rihanna - Where Have You Been)
  const VIDEO_ID = 'HBxt_v0WF6Y'; // <- change if needed

  // UI elements
  const playBtn = document.getElementById('mpPlay');
  const prog = document.getElementById('mpProgress');
  const vol = document.getElementById('mpVolume');
  const timeDisplay = document.getElementById('mpTime');
  const rew = document.getElementById('mpRew');
  const fwd = document.getElementById('mpFwd');
  const titleEl = document.getElementById('mpTitle');

  let ytPlayer = null;
  let ytReady = false;
  let durationSec = 0;
  let progressInterval = null;

  // helper to format seconds
  function fmt(s){ if(!s || isNaN(s)) return '0:00'; const m=Math.floor(s/60), sec=Math.floor(s%60); return m+':'+(sec<10?'0'+sec:sec); }

  // load YT IFrame API and create player
  function loadYouTubeAndCreatePlayer(onReadyCallback){
    if (window.YT && window.YT.Player) { createPlayer(onReadyCallback); return; }

    // inject API script
    const s = document.createElement('script');
    s.src = "https://www.youtube.com/iframe_api";
    document.head.appendChild(s);

    // global callback used by API
    window.onYouTubeIframeAPIReady = function(){
      createPlayer(onReadyCallback);
    };
  }

  // create the hidden player (small, off-screen)
  function createPlayer(callback){
    const container = document.getElementById('yt-player-container');
    const iframeId = 'ytplayer-iframe';

    // create div placeholder
    const placeholder = document.createElement('div');
    placeholder.id = iframeId;
    container.appendChild(placeholder);

    ytPlayer = new YT.Player(iframeId, {
      height: '1',
      width: '1',
      videoId: VIDEO_ID,
      playerVars: {
        autoplay: 0,
        controls: 0,
        rel: 0,
        modestbranding: 1,
        disablekb: 1,
        playsinline: 1,
        loop: 1,
        playlist: VIDEO_ID
      },
      events: {
        onReady: function(event){
          ytReady = true;
          durationSec = ytPlayer.getDuration() || 0;
          titleEl.textContent = 'Now playing ‚Äî YouTube';
          if (callback) callback();
        },
        onStateChange: function(ev){
          // update UI when play/pause
          const state = ev.data;
          // YT states: -1 (unstarted), 0 ended, 1 playing, 2 paused, 3 buffering
          if (state === 1) { playBtn.textContent = '‚è∏Ô∏è'; startProgressUpdater(); }
          else if (state === 2 || state === 0) { playBtn.textContent = '‚ñ∂Ô∏è'; stopProgressUpdater(); }
        }
      }
    });
  }

  // progress updater (poll currentTime)
  function startProgressUpdater(){
    stopProgressUpdater();
    progressInterval = setInterval(()=>{
      if (!ytReady || !ytPlayer || typeof ytPlayer.getCurrentTime !== 'function') return;
      const cur = ytPlayer.getCurrentTime();
      durationSec = ytPlayer.getDuration() || durationSec;
      if (durationSec) prog.value = (cur / durationSec) * 100;
      timeDisplay.textContent = fmt(cur) + ' / ' + fmt(durationSec);
    }, 300);
  }
  function stopProgressUpdater(){ if (progressInterval) { clearInterval(progressInterval); progressInterval=null; } }

  // control handlers (attempt safe calls if not ready)
  playBtn.addEventListener('click', ()=>{
    if (!ytReady) {
      // not ready: trigger the initial click loader (if user pressed play directly without earlier click)
      initPlayerOnFirstClick();
      return;
    }
    const state = ytPlayer.getPlayerState();
    if (state === 1) ytPlayer.pauseVideo();
    else ytPlayer.playVideo();
  });

  rew.addEventListener('click', ()=> {
    if (!ytReady) return;
    const t = Math.max(0, ytPlayer.getCurrentTime() - 10);
    ytPlayer.seekTo(t, true);
  });
  fwd.addEventListener('click', ()=> {
    if (!ytReady) return;
    const t = Math.min((ytPlayer.getDuration()||0), ytPlayer.getCurrentTime() + 10);
    ytPlayer.seekTo(t, true);
  });

  // progress drag
  prog.addEventListener('input', ()=> prog.dragging = true);
  prog.addEventListener('change', ()=>{
    if (!ytReady || !ytPlayer || !ytPlayer.seekTo) { prog.dragging=false; return; }
    const t = (prog.value/100) * (ytPlayer.getDuration() || 0);
    ytPlayer.seekTo(t, true);
    prog.dragging = false;
  });

  // volume control (YouTube API uses 0-100)
  vol.addEventListener('input', ()=> {
    if (!ytReady) return;
    ytPlayer.setVolume(Math.round(parseFloat(vol.value) * 100));
  });

  // ensure if user clicks anywhere once, we init player and start playing
  function initPlayerOnFirstClick(){
    // prevent double-init
    if (ytPlayer || window._yt_init_started) return;
    window._yt_init_started = true;

    // load API + create player, then play once ready
    loadYouTubeAndCreatePlayer(() => {
      // mute to avoid sudden loudness if volume control not set? we'll set volume from slider
      ytPlayer.setVolume(Math.round(parseFloat(vol.value)*100));
      // start playback
      ytPlayer.playVideo();
    });
  }

  // init on first page click (to satisfy autoplay policies)
  document.addEventListener('click', function oneClickInit(){
    initPlayerOnFirstClick();
    // also remove this listener after first click
    document.removeEventListener('click', oneClickInit);
  }, { once: true });

  // cleanup on page unload
  window.addEventListener('beforeunload', ()=> { if (ytPlayer && ytPlayer.pauseVideo) try{ ytPlayer.pauseVideo(); }catch(e){} });

  // safety: update UI time while waiting (0:00)
  setInterval(()=> {
    if (!ytReady) timeDisplay.textContent = '0:00 / 0:00';
  }, 1000);

})();
</script>
</body>
</html>
