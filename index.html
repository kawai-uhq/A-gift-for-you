<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>For You My Love</title>
<style>
  :root{ --accent:#ff6666; --sun-glow: rgba(255,126,95,0.4); --quest-blue: rgba(100,160,255,0.18); }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#ffaf7b,#ff7b7b,#7b4397);-webkit-font-smoothing:antialiased;touch-action:manipulation;-webkit-tap-highlight-color:transparent;overflow:hidden;user-select:none}

  /* stage blur */
  #stage{position:relative;height:100%;width:100%;transition:filter .45s ease,transform .45s ease}
  #stage.blurred{filter:blur(8px) saturate(.95) contrast(.98); transform: scale(.995);}

  /* Reveal overlay */
  #revealOverlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:9999999;background:#342018;cursor:pointer}
  #revealText{color:#fff;font-weight:700;font-size:clamp(20px,3.6vw,36px);letter-spacing:0.6px;text-transform:lowercase;user-select:none;animation: overlayPulse 1.6s ease-in-out infinite}
  @keyframes overlayPulse{0%{transform:translateY(0) scale(1)}50%{transform:translateY(-6px) scale(1.02)}100%{transform:translateY(0) scale(1)}}

  /* instruction box */
  .instruction {
    position:fixed;
    left:50%;
    top:18%;
    transform:translateX(-50%);
    z-index:100001;
    background: rgba(255,255,255,0.98);
    color:#222;
    padding:14px 18px;
    border-radius:12px;
    box-shadow:0 18px 40px rgba(0,0,0,0.35);
    font-weight:700;
    font-size:clamp(14px,2vw,18px);
    text-align:center;
    cursor:pointer;
    transition:opacity .45s ease, transform .45s ease;
    pointer-events:auto;
  }
  .instruction.fadeout { opacity:0; transform: translateX(-50%) translateY(-8px) scale(.98); }

  /* quest box (top-center) */
  .quest-box {
    position:fixed;
    left:50%;
    top:5%;
    transform:translateX(-50%) translateY(0);
    z-index:100001;
    background:linear-gradient(90deg,#ff7b7b,#ff4a8a);
    color:#fff;
    padding:10px 18px;
    border-radius:12px;
    box-shadow:0 12px 30px rgba(0,0,0,0.35);
    font-weight:800;
    cursor:pointer;
    user-select:none;
    opacity:0;
    transform-origin:center;
    transition:opacity .28s ease, transform .28s cubic-bezier(.2,.9,.2,1);
    display:inline-flex;
    align-items:center;
    gap:10px;
  }
  .quest-box.show { opacity:1; transform:translateX(-50%) translateY(0) scale(1); }
  .quest-box.glow { box-shadow:0 12px 38px rgba(0,90,255,0.08), 0 0 40px rgba(80,150,255,0.06) inset; animation: questGlow 2.2s ease-in-out infinite; }
  @keyframes questGlow {
    0% { box-shadow: 0 12px 38px rgba(0,90,255,0.06), 0 0 0 rgba(80,150,255,0.00) inset; }
    50% { box-shadow: 0 18px 60px rgba(0,110,255,0.10), 0 0 30px rgba(80,150,255,0.10) inset; }
    100% { box-shadow: 0 12px 38px rgba(0,90,255,0.06), 0 0 0 rgba(80,150,255,0.00) inset; }
  }

  /* notification red dot */
  .notif {
    width:20px;height:20px;border-radius:50%;background:#e53935;color:#fff;font-weight:800;display:inline-flex;align-items:center;justify-content:center;font-size:12px;box-shadow:0 4px 12px rgba(0,0,0,0.18);
    margin-left:6px;
  }

  /* visual elements (sun, petals, hearts, land, tree) */
  .sun{position:absolute;top:-50px;left:-50px;width:260px;height:260px;border-radius:50%;background:radial-gradient(circle,#ff5533 0%,#ff7e5f 50%,rgba(255,126,95,0) 70%);filter:blur(20px);box-shadow:0 0 120px 40px var(--sun-glow);z-index:0;cursor:pointer;animation:sunMove 30s ease-in-out infinite}
  @keyframes sunMove{0%{top:-60px;left:-60px}50%{top:60px;left:-40px}75%{top:140px;left:-20px}100%{top:-60px;left:-60px}}
  .petal-wrap{position:absolute;top:0;left:0;pointer-events:auto;will-change:transform,opacity}
  .petal{display:inline-block;user-select:none;cursor:pointer;will-change:transform,opacity;text-shadow:0 2px 6px rgba(0,0,0,0.06)}
  @keyframes fallDown{0%{transform:translateY(-10vh)}100%{transform:translateY(120vh)}}
  .heart{position:absolute;cursor:pointer;user-select:none;animation:pop 1.4s ease forwards}
  @keyframes pop{0%{transform:scale(.6);opacity:0}50%{transform:scale(1.15);opacity:1}100%{transform:scale(.6);opacity:0}}
  .land{position:absolute;bottom:-40px;left:0;width:120%;height:200px;background:linear-gradient(to bottom,#3d1f1f 0%,#1a0f0f 80%);border-top-left-radius:50% 100px;border-top-right-radius:50% 100px;transform:translateX(-10%);z-index:5;box-shadow:0 -15px 25px rgba(0,0,0,0.4) inset}
  .tree-scene{position:absolute;bottom:100px;right:0;width:280px;height:280px;z-index:6;cursor:pointer}
  svg{width:100%;height:100%;fill:#1a0f16}
  .tree-top{transform-box:fill-box;transform-origin:75% 30%;animation:treeSway 6s ease-in-out infinite}
  @keyframes treeSway{0%,100%{transform:rotate(-2deg)}50%{transform:rotate(2deg)}}
  .swing{transform-box:fill-box;transform-origin:50% 0%;animation:swingMotion 4.2s ease-in-out infinite}
  @keyframes swingMotion{0%{transform:rotate(6deg)}50%{transform:rotate(-6deg)}100%{transform:rotate(6deg)}}

  /* message bubble */
  .message{
    position:absolute;
    background:rgba(255,255,255,0.98);
    padding:10px 14px;
    border-radius:16px;
    font-weight:600;
    font-size:1rem;
    color:#222;
    opacity:0;
    transform:translateY(8px) scale(.98);
    animation:msgIn .28s ease forwards;
    z-index:120;
    pointer-events:none;
    white-space:normal;
    line-height:1.2;
    max-width:40vw;
    box-shadow:0 10px 30px rgba(0,0,0,0.12);
    word-wrap:break-word;
  }
  @keyframes msgIn{0%{opacity:0;transform:translateY(8px) scale(.98)}100%{opacity:1;transform:translateY(0) scale(1)}}

  /* mini player */
  #miniPlayer{position:fixed;left:18px;bottom:18px;width:320px;max-width:92%;background:rgba(0,0,0,0.35);padding:12px;border-radius:12px;color:#fff;z-index:9999;backdrop-filter:blur(6px);box-shadow:0 10px 30px rgba(0,0,0,0.5);transition:transform .25s,opacity .25s;display:none}
  .close-btn{position:absolute;top:6px;right:8px;color:#fff;background:none;border:none;font-size:18px;cursor:pointer}

  /* player buttons cleaned up - remove white bg/borders */
  #miniPlayer .mp-buttons button {
    background:transparent;
    border:none;
    color:inherit;
    font-size:18px;
    padding:6px;
    margin-right:6px;
    border-radius:6px;
    cursor:pointer;
    -webkit-appearance:none;
    outline:none;
  }
  #miniPlayer .mp-buttons button:focus { outline:none; box-shadow:none; }
  #miniPlayer input[type=range] { width:100%; margin-top:8px; }

  /* mini disc (CD look) */
  .mini-disc{
    position:fixed;
    left:25px;
    bottom:25px;
    width:64px;
    height:64px;
    border-radius:50%;
    background-size:cover;
    background-position:center center;
    cursor:pointer;
    z-index:99999;
    transition:transform .2s,opacity .2s;
    border:6px solid #fff;
    box-shadow: inset 0 -6px 12px rgba(0,0,0,0.18), 0 8px 24px rgba(0,0,0,0.45);
    background-clip: padding-box;
    background-color: #111;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .mini-disc--ring{box-shadow: inset 0 -6px 12px rgba(0,0,0,0.18), 0 8px 24px rgba(0,0,0,0.45), 0 0 18px rgba(255,120,120,0.12)}
  .mini-disc.rotating{animation:spin 6s linear infinite}
  .mini-disc::after{
    content:'';
    width:20px;
    height:20px;
    border-radius:50%;
    background: radial-gradient(circle at 35% 30%, rgba(255,255,255,0.15), rgba(255,255,255,0.02) 40%, rgba(0,0,0,0.12) 60%);
    border:2px solid rgba(255,255,255,0.35);
    box-shadow: inset 0 -4px 8px rgba(0,0,0,0.2);
  }
  @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
  @media(max-width:420px){#miniPlayer{width:92%;left:8px;bottom:12px}}

  /* panels & typewriter */
  .panel-root{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:100000;pointer-events:none}
  .panel{background:rgba(255,255,255,0.98);padding:20px 24px;border-radius:14px;box-shadow:0 18px 50px rgba(0,0,0,0.35);text-align:center;pointer-events:auto;max-width:92%;width:520px}
  .panel h2{font-size:1.4rem;margin-bottom:8px;color:#222;min-height:1.65em}
  .panel p{color:#444;margin-bottom:12px;min-height:1.3em}
  .choices{display:flex;gap:12px;justify-content:center;margin-top:6px}
  .btn{padding:10px 16px;border-radius:10px;border:none;font-weight:800;cursor:pointer;transition:transform .18s ease,box-shadow .18s ease}
  .btn-yes{background:linear-gradient(90deg,#ff7b7b,#ff4a8a);color:#fff;box-shadow:0 8px 22px rgba(255,80,120,0.18)}
  .btn-no{background:#eee;color:#222}
  .btn-name{background:#fff;color:#222;border:2px solid #efefef;padding:10px 12px}
  .small{font-size:.95rem}
  .confetti-heart{position:absolute;font-size:20px;opacity:0;animation:heartPop 1.2s ease forwards}
  @keyframes heartPop{0%{transform:translateY(0) scale(.6);opacity:0}40%{opacity:1;transform:translateY(-18px) scale(1.15)}100%{opacity:0;transform:translateY(-60px) scale(.8)}}

  /* typewriter caret */
  .typewriter.caret::after{
    content: '';
    display:inline-block;
    width:10px;
    height:1.2em;
    margin-left:6px;
    vertical-align:middle;
    background:linear-gradient(90deg,#222,#222);
    animation: blink 1s steps(2) infinite;
  }
  @keyframes blink{50%{opacity:0}}

  .hidden{visibility:hidden;opacity:0;transform:translateY(6px);transition:all .24s ease}
  .visible{visibility:visible;opacity:1;transform:translateY(0);transition:all .28s cubic-bezier(.2,.9,.2,1)}
</style>
</head>
<body>

<!-- reveal overlay -->
<div id="revealOverlay" tabindex="0" role="button" aria-label="Click to reveal">
  <div id="revealText">click to enter...</div>
</div>

<!-- main stage -->
<div id="stage" class="blurred" aria-hidden="true">
  <div class="sun" id="sun" title="Click the sun"></div>
  <div class="land" id="land" aria-hidden="true"></div>

  <div class="tree-scene" id="treeScene" role="button" aria-label="Tree with swing">
    <svg viewBox="0 0 300 300" aria-hidden="true">
      <path d="M230 300 L250 160 L270 300 Z" fill="#1a0f16"/>
      <g class="tree-top">
        <circle cx="250" cy="140" r="60"/>
        <circle cx="220" cy="120" r="50"/>
        <circle cx="280" cy="120" r="50"/>
      </g>
      <path d="M200 150 C210 140, 240 135, 260 145" stroke="#1a0f16" stroke-width="6" fill="none" stroke-linecap="round"/>
      <line x1="200" y1="150" x2="200" y2="230" stroke="#1a0f16" stroke-width="3"/>
      <line x1="220" y1="150" x2="220" y2="230" stroke="#1a0f16" stroke-width="3"/>
      <g class="swing">
        <rect x="190" y="230" width="40" height="6" fill="#1a0f16"/>
        <circle cx="200" cy="220" r="6" fill="#1a0f16"/>
        <circle cx="215" cy="220" r="6" fill="#1a0f16"/>
      </g>
    </svg>
  </div>
</div>

<!-- music player -->
<div id="miniPlayer" aria-hidden="true">
  <button class="close-btn" id="closePlayer" aria-label="Minimize">×</button>
  <div id="mpControls">
    <div class="mp-title" id="mpTitle">Where have you been</div>
    <div class="mp-buttons">
      <button id="mpRew" title="Rewind 10s">⏪</button>
      <button id="mpPlay" aria-label="Play">▶️</button>
      <button id="mpFwd" title="Forward 10s">⏩</button>
    </div>
    <input type="range" id="mpProgress" min="0" max="100" value="0" aria-label="Progress">
    <div id="mpTime">0:00 / 0:00</div>
    <div style="margin-top:8px;">
      <label style="font-size:12px;color:#ffdede">Volume</label>
      <input type="range" id="mpVolume" min="0" max="1" step="0.01" value="0.6" aria-label="Volume">
    </div>
  </div>
</div>

<!-- panel root -->
<div id="panelRoot" class="panel-root" style="display:none;"></div>

<!-- YT container -->
<div id="yt-player-container" style="position:fixed;right:-9999px;bottom:-9999px;width:1px;height:1px;overflow:hidden"></div>

<script>
/* ---------------- typewriter utility ---------------- */
function typeWrite(el, text, speed = 32) {
  return new Promise(resolve => {
    el.classList.add('typewriter','caret');
    el.textContent = '';
    let i = 0;
    function tick() {
      if (i < text.length) {
        el.textContent += text[i++];
        const delay = speed + Math.random()*Math.min(60, speed);
        setTimeout(tick, delay);
      } else {
        el.classList.remove('caret');
        resolve();
      }
    }
    tick();
  });
}

/* ---------------- petals & hearts ---------------- */
(function(){
  const stage = document.getElementById('stage');
  const numPetals = 40;
  for (let i=0;i<numPetals;i++){
    const w=document.createElement('div'); w.className='petal-wrap';
    const depth=Math.ceil(Math.random()*3);
    const size = depth===1 ? Math.random()*20+24 : depth===2 ? Math.random()*18+16 : Math.random()*14+10;
    const fall = depth===1 ? Math.random()*5+7 : depth===2 ? Math.random()*7+9 : Math.random()*9+11;
    w.style.left = Math.random()*100 + 'vw';
    w.style.top = Math.random()*-200 + 'px';
    w.style.animation = `fallDown ${fall}s linear infinite ${Math.random()*5}s`;
    w.style.zIndex = depth===1?9:depth===2?7:5;
    w.style.opacity = depth===1?0.95:depth===2?0.75:0.5;
    const p = document.createElement('div'); p.className='petal'; p.textContent='🌸'; p.style.fontSize=size+'px';
    p.style.animationDuration = (Math.random()*2+3).toFixed(2)+'s';
    w.appendChild(p); stage.appendChild(w);
  }
  function createHeart(){
    const h=document.createElement('div'); h.className='heart'; h.textContent='💗';
    h.style.left=(10+Math.random()*75)+'vw'; h.style.top=(30+Math.random()*50)+'vh';
    h.style.fontSize=(Math.random()*20+12)+'px'; h.style.zIndex=8;
    stage.appendChild(h); setTimeout(()=>h.remove(),2000);
  }
  setInterval(createHeart,700);
})();

/* ---------------- click messages & land positioning (fixed) ---------------- */
(function(){
  // improved message placement:
  // - append message to DOM
  // - measure actual width/height
  // - compute clamped left/top so the bubble is fully visible
  function createMessageElement(text, opts={}) {
    const m=document.createElement('div'); m.className='message'; m.textContent=text;
    if (opts.color) m.style.color=opts.color;
    if (opts.box) m.style.boxShadow=opts.box;
    // temporarily put off-screen to measure
    m.style.left='-9999px'; m.style.top='-9999px';
    document.getElementById('stage').appendChild(m);
    return m;
  }

  function placeAndScheduleRemoval(m, targetX, targetY) {
    // measure size
    const rect = m.getBoundingClientRect();
    const padding = 12;
    const vw = window.innerWidth;
    const vh = window.innerHeight;
    // default: show slightly above the click point
    let left = Math.round(targetX - rect.width/2);
    let top  = Math.round(targetY - rect.height - 18); // above cursor / click
    // if it would be off top, show below click
    if (top < padding) top = Math.round(targetY + 12);
    // clamp horizontally
    left = Math.max(padding, Math.min(left, vw - rect.width - padding));
    top = Math.max(padding, Math.min(top, vh - rect.height - padding));
    m.style.left = left + 'px';
    m.style.top  = top + 'px';
    // removal after 4.2s
    setTimeout(()=> { if (m && m.parentNode) m.parentNode.removeChild(m); }, 4200);
  }

  function showMsg(text, opts={}) {
    // opts.pos: {x,y} preferred click coordinates
    // opts.anchorRect: fallback anchor rect (centred)
    const m = createMessageElement(text, opts);
    // decide where to place
    if (opts.pos && typeof opts.pos.x === 'number') {
      placeAndScheduleRemoval(m, opts.pos.x, opts.pos.y);
    } else if (opts.anchorRect) {
      const r = opts.anchorRect;
      const cx = r.left + r.width/2;
      const cy = r.top;
      placeAndScheduleRemoval(m, cx, cy);
    } else if (opts.near) {
      const r = opts.near;
      const sx = (r.right || window.innerWidth) - 40;
      const sy = (r.top || 60);
      placeAndScheduleRemoval(m, sx, sy);
    } else {
      // default top-left
      placeAndScheduleRemoval(m, 100, 100);
    }
  }

  document.addEventListener('click', (e)=>{
    const petalWrap = e.target.closest('.petal-wrap');
    if (petalWrap && e.target.classList.contains('petal')){
      e.stopPropagation();
      const pastel = ['#ffb6c1','#ffc8dd','#cdb4db','#bde0fe','#a2d2ff','#fbc4ab','#ffafcc','#c8b6ff','#b5ead7','#fdfd96'];
      const color = pastel[Math.floor(Math.random()*pastel.length)];
      const rect = petalWrap.getBoundingClientRect();
      showMsg("You're cute as this flower :3", {color, box:`0 0 25px ${color}80`, anchorRect: rect});
      return;
    }
    if (e.target.classList.contains('heart')){
      e.stopPropagation();
      const texts=["You stole my heart ♥️","I love you 💝"]; const t=texts[Math.floor(Math.random()*texts.length)];
      const glow=['#ff66b2','#ff1493','#ff3366','#ff6f91','#ff85a1','#ff3f6e'][Math.floor(Math.random()*6)];
      const rect = e.target.getBoundingClientRect();
      showMsg(t,{color:glow, box:`0 0 30px ${glow}a0`, anchorRect: rect});
      return;
    }
    // land click: position right where clicked (improved)
    if (e.target.id === 'land' || e.target.closest('#land')) {
      e.stopPropagation();
      const clickX = e.clientX;
      const clickY = e.clientY;
      showMsg("I wanna hold you like the earth holds us 💪🏻!", {color:'#6b4f2b', box:'0 0 20px rgba(107,79,43,0.12)', pos:{x:clickX,y:clickY}});
      return;
    }
  });

  // Tree click: calculate tree bounding rect and show message near the tree (explicit pos)
  document.getElementById('sun').addEventListener('click', (e)=>{ e.stopPropagation(); showMsg("Dayum, you're so hot 🥵, I'll get wet!", {color:'#ff3f6e', box:'0 0 30px rgba(255,90,120,0.6)', near: e.target.getBoundingClientRect()}); });

  document.getElementById('treeScene').addEventListener('click',(e)=>{
    e.stopPropagation();
    // measure tree position and show bubble just to the left/top of the tree/swing
    const rect = e.currentTarget.getBoundingClientRect();
    // position slightly left of the tree center and slightly above the swing
    const posX = Math.max(60, rect.left + rect.width/2 - 140);
    const posY = Math.max(60, rect.top + 40); // near upper part of tree
    showMsg("Us swinging one day! 🩵", {pos:{x: posX, y: posY}, color:'#003366', box:'0 0 25px rgba(150,200,255,0.6)'});
  });

})();

/* ---------------- YouTube player & mini-disc (clean controls) ---------------- */
(function(){
  const VIDEO_ID = 'HBxt_v0WF6Y'; // change as needed
  const playBtn = document.getElementById('mpPlay'), prog = document.getElementById('mpProgress'), vol = document.getElementById('mpVolume'), timeDisplay = document.getElementById('mpTime'), rew = document.getElementById('mpRew'), fwd = document.getElementById('mpFwd');
  const miniPlayer = document.getElementById('miniPlayer'), closeBtn = document.getElementById('closePlayer');
  const ytContainer = document.getElementById('yt-player-container');
  let ytPlayer=null, ytReady=false, progressInterval=null, disc=null;

  function fmt(s){ if(!s||isNaN(s)) return '0:00'; const m=Math.floor(s/60), sec=Math.floor(s%60); return m+':'+(sec<10?'0'+sec:sec); }
  function loadYT(cb){ if(window.YT && YT.Player){ cb(); return; } const s=document.createElement('script'); s.src='https://www.youtube.com/iframe_api'; document.head.appendChild(s); window.onYouTubeIframeAPIReady = cb; }
  function createYT(cb){
    const ph=document.createElement('div'); ph.id='ytplayer'; ytContainer.appendChild(ph);
    ytPlayer=new YT.Player('ytplayer',{height:'1',width:'1',videoId:VIDEO_ID,playerVars:{autoplay:0,controls:0,rel:0,modestbranding:1,playsinline:1,loop:1,playlist:VIDEO_ID},events:{onReady:()=>{ytReady=true; ytPlayer.setVolume(Math.round(parseFloat(vol.value)*100)); if(typeof cb==='function') cb();}, onStateChange:(ev)=>{ if(ev.data===1){ if(playBtn) playBtn.textContent='⏸️'; if(disc) disc.classList.add('rotating'); startProgress(); } else if(ev.data===2||ev.data===0){ if(playBtn) playBtn.textContent='▶️'; if(disc) disc.classList.remove('rotating'); stopProgress(); } } }});
  }
  function startProgress(){ stopProgress(); progressInterval=setInterval(()=>{ if(!ytReady||!ytPlayer) return; const cur=ytPlayer.getCurrentTime(), dur=ytPlayer.getDuration()||0; if(prog) prog.value = dur? (cur/dur)*100 : 0; if(timeDisplay) timeDisplay.textContent = fmt(cur) + ' / ' + fmt(dur); },300); }
  function stopProgress(){ if(progressInterval){ clearInterval(progressInterval); progressInterval=null; } }

  // expose init (called by reveal)
  window.initOnFirstClick = function(){
    if (ytPlayer || window._yt_init_started) return;
    window._yt_init_started = true;
    loadYT(function(){ createYT(function(){ try{ ytPlayer.playVideo(); }catch(e){} startProgress(); miniPlayer.style.display='block'; }); });
  };

  // controls
  if (playBtn) playBtn.addEventListener('click', ()=>{ if(!ytReady){ window.initOnFirstClick(); return; } const s=ytPlayer.getPlayerState(); if(s===1) ytPlayer.pauseVideo(); else ytPlayer.playVideo(); });
  if (rew) rew.addEventListener('click', ()=>{ if(!ytReady) return; ytPlayer.seekTo(Math.max(0, ytPlayer.getCurrentTime()-10), true); });
  if (fwd) fwd.addEventListener('click', ()=>{ if(!ytReady) return; ytPlayer.seekTo(Math.min(ytPlayer.getDuration()||0, ytPlayer.getCurrentTime()+10), true); });
  if (prog) { prog.addEventListener('input', ()=> prog.dragging=true); prog.addEventListener('change', ()=>{ if(!ytReady){ prog.dragging=false; return; } const t=(prog.value/100)*(ytPlayer.getDuration()||0); ytPlayer.seekTo(t,true); prog.dragging=false; }); }
  if (vol) vol.addEventListener('input', ()=>{ if(!ytReady) return; ytPlayer.setVolume(Math.round(parseFloat(vol.value)*100)); });

  // minimize to disc with thumbnail (CD border + inner circle via CSS ::after)
  if (closeBtn) closeBtn.addEventListener('click', ()=>{
    miniPlayer.style.opacity='0'; miniPlayer.style.transform='scale(0.92)';
    setTimeout(()=>{
      miniPlayer.style.display='none';
      if(!disc){
        disc=document.createElement('div'); disc.className='mini-disc mini-disc--ring';
        disc.style.backgroundImage = `url('https://img.youtube.com/vi/${VIDEO_ID}/hqdefault.jpg')`;
        document.body.appendChild(disc);
        disc.addEventListener('click', ()=>{ if(disc){ disc.remove(); disc=null; } miniPlayer.style.display='block'; setTimeout(()=>{ miniPlayer.style.opacity='1'; miniPlayer.style.transform='scale(1)'; },20); });
      }
      try{ if(ytReady && ytPlayer.getPlayerState && ytPlayer.getPlayerState()===1) disc.classList.add('rotating'); else disc.classList.remove('rotating'); }catch(e){}
    },200);
  });

  // update rotation state periodically
  setInterval(()=>{ if(!disc) return; try{ if(ytReady && ytPlayer && typeof ytPlayer.getPlayerState==='function'){ const s=ytPlayer.getPlayerState(); if(s===1) disc.classList.add('rotating'); else disc.classList.remove('rotating'); } }catch(e){} },600);
  window.addEventListener('beforeunload', ()=>{ if(disc) try{ disc.remove(); }catch(e){} });
})();

/* ---------------- panels flow (with typewriter) ---------------- */
(function(){
  const panelRoot = document.getElementById('panelRoot');
  let chosenName = null;

  function createPanel(){
    panelRoot.innerHTML = '';
    const panel = document.createElement('div'); panel.className = 'panel';
    panelRoot.appendChild(panel);
    panelRoot.style.display = 'flex';
    return panel;
  }

  async function showNamePicker(){
    const panel = createPanel();
    panel.innerHTML = `<h2 id="nameHeading"></h2>
      <div class="choices small" id="nameButtons" style="margin-top:14px;">
        <button class="btn btn-name hidden" id="pickA">Répási Csenge Nadin</button>
        <button class="btn btn-name hidden" id="pickB">Ashley</button>
      </div>`;
    const nameHeading = panel.querySelector('#nameHeading');
    const pickA = panel.querySelector('#pickA');
    const pickB = panel.querySelector('#pickB');

    await typeWrite(nameHeading, "Hey, Répási Csenge Nadin or shall I say Ashley?");
    pickA.classList.remove('hidden'); pickA.classList.add('visible');
    pickB.classList.remove('hidden'); pickB.classList.add('visible');

    pickA.addEventListener('click', ()=>{ chosenName = 'Répási Csenge Nadin'; proceedAfterName(); });
    pickB.addEventListener('click', ()=>{ chosenName = 'Ashley'; proceedAfterName(); });
  }

  async function proceedAfterName(){
    const panel = createPanel();
    panel.innerHTML = `<p id="loveLine" class="small"></p>`;
    const loveLine = panel.querySelector('#loveLine');
    await typeWrite(loveLine, "We have spent so many days together, lowkey feels unreal. I love you very much >_<! Sooooo...");
    setTimeout(()=> showProposal(), 800);
  }

  async function showProposal(){
    const panel = createPanel();
    panel.innerHTML = `<h2 id="proposalQ"></h2><p id="proposalP"></p>
      <div class="choices" id="proposalButtons" style="margin-top:14px;">
        <button class="btn btn-yes hidden" id="btnYes">yes</button>
        <button class="btn btn-no hidden" id="btnNo">no</button>
      </div>`;
    const q = panel.querySelector('#proposalQ');
    const p = panel.querySelector('#proposalP');
    const yes = panel.querySelector('#btnYes');
    const no = panel.querySelector('#btnNo');

    await typeWrite(q, "Will you marry me?");
    await typeWrite(p, "I want to spend the rest of my life with you.");
    yes.classList.remove('hidden'); yes.classList.add('visible');
    no.classList.remove('hidden'); no.classList.add('visible');

    let noClicks = 0;
    let yesScale = 1;
    yes.addEventListener('click', (e)=>{
  e.stopPropagation();
  const full = `${chosenName} Das`;
  panel.innerHTML = `<h2>You made Aniket's heart happy 💖</h2><p>and you have successfully become <strong>${full}</strong></p>`;
  spawnHearts(3);

  // redirect to picture.html after 7 seconds
  setTimeout(() => {
    window.location.href = "picture.html";
  }, 7000);
});

    no.addEventListener('click', (e)=>{
      e.stopPropagation();
      noClicks++;
      yesScale *= 1.18;
      yes.style.transform = `scale(${yesScale})`;
      yes.style.boxShadow = '0 12px 30px rgba(255,80,140,0.18)';

      const panelRect = panel.getBoundingClientRect();
      const noRect = no.getBoundingClientRect();
      const cx = panelRect.left + panelRect.width/2;
      const cy = panelRect.top + panelRect.height/2;
      let dx = (noRect.left + noRect.width/2) - cx;
      let dy = (noRect.top + noRect.height/2) - cy;
      const len = Math.sqrt(dx*dx + dy*dy) || 1;
      dx /= len; dy /= len;
      const magnitude = 80 + noClicks * 90;
      const tx = dx * magnitude;
      const ty = dy * magnitude * 0.6;
      no.style.transition = 'transform 0.45s cubic-bezier(.2,.9,.2,1), opacity .4s';
      no.style.transform = `translate(${tx}px, ${ty}px)`;

      yes.style.transition = 'transform .18s';
      setTimeout(()=> yes.style.transform = `scale(${yesScale}) translateY(-6px)`, 120);
      setTimeout(()=> yes.style.transform = `scale(${yesScale}) translateY(0)`, 320);

      setTimeout(()=> {
        const nr = no.getBoundingClientRect();
        const offLeft = nr.right < 0;
        const offRight = nr.left > window.innerWidth;
        const offTop = nr.bottom < 0;
        const offBottom = nr.top > window.innerHeight;
        if (offLeft || offRight || offTop || offBottom){
          no.style.opacity = '0';
          no.style.pointerEvents = 'none';
        }
      }, 520);
    });
  }

  function spawnHearts(count){
    for(let i=0;i<count;i++){
      const h=document.createElement('div'); h.className='confetti-heart'; h.textContent='💗';
      h.style.left = (40 + Math.random()*30) + 'vw';
      h.style.top = (50 + Math.random()*10 - 40) + 'vh';
      h.style.fontSize = (14 + Math.random()*28) + 'px';
      document.body.appendChild(h);
      setTimeout(()=> h.remove(), 1700 + Math.random()*800);
    }
  }

  window.showNamePicker = showNamePicker;
})();

/* ---------------- reveal overlay -> instruction -> quest (top center) ---------------- */
(function(){
  const overlay = document.getElementById('revealOverlay');
  const stage = document.getElementById('stage');
  let instructionEl = null;
  let questEl = null;
  let instructionTimeout = null;

  function createInstruction() {
    instructionEl = document.createElement('div');
    instructionEl.className = 'instruction';
    instructionEl.textContent = "Hey, try clicking on the petals, tree/swing, heart, land, sun and maybe also on the NO option later in the quest 😜!";
    document.body.appendChild(instructionEl);

    instructionEl.addEventListener('click', ()=> { dismissInstruction(true); });
    instructionTimeout = setTimeout(()=> dismissInstruction(false), 5000);
  }

  function dismissInstruction(immediate) {
    if (!instructionEl) return;
    clearTimeout(instructionTimeout);
    if (immediate) {
      instructionEl.remove(); instructionEl = null; showQuestBox(); return;
    }
    instructionEl.classList.add('fadeout');
    setTimeout(()=> { if (instructionEl) { instructionEl.remove(); instructionEl = null; } showQuestBox(); }, 480);
  }

  function showQuestBox() {
    if (questEl) return;
    questEl = document.createElement('div');
    questEl.className = 'quest-box';
    questEl.innerHTML = '<span style="font-weight:900;letter-spacing:.6px">Quest</span>';
    const dot = document.createElement('span'); dot.className='notif'; dot.textContent='1';
    dot.setAttribute('aria-hidden','true');
    questEl.appendChild(dot);

    document.body.appendChild(questEl);
    setTimeout(()=> { questEl.classList.add('show'); questEl.classList.add('glow'); }, 60);

    questEl.addEventListener('click', ()=> {
      questEl.classList.remove('show','glow');
      setTimeout(()=> { if (questEl) { questEl.remove(); questEl = null; } }, 280);
      if (typeof window.showNamePicker === 'function') window.showNamePicker();
    });
  }

  function reveal(){
    overlay.style.transition = 'opacity .28s ease';
    overlay.style.opacity = '0';
    setTimeout(()=> overlay.remove(), 320);
    stage.classList.remove('blurred');
    stage.setAttribute('aria-hidden','false');
    if (typeof window.initOnFirstClick === 'function') {
      try { window.initOnFirstClick(); } catch(e){}
    }
    setTimeout(()=> { createInstruction(); }, 420);
  }

  overlay.addEventListener('click', reveal, { once:true });
  overlay.addEventListener('keydown', function(e){ if (e.key==='Enter' || e.key===' ') { reveal(); e.preventDefault(); } });
  overlay.setAttribute('tabindex','0');
})();
</script>
</body>
</html>
