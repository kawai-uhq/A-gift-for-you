<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>For You — Proposal (typewriter)</title>
<style>
  :root{ --accent:#ff6666; --sun-glow: rgba(255,126,95,0.4); }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#ffaf7b,#ff7b7b,#7b4397);-webkit-font-smoothing:antialiased;touch-action:manipulation;-webkit-tap-highlight-color:transparent;overflow:hidden}

  /* stage blur */
  #stage{position:relative;height:100%;width:100%;transition:filter .45s ease,transform .45s ease}
  #stage.blurred{filter:blur(8px) saturate(.95) contrast(.98); transform: scale(.995);}

  /* Reveal overlay */
  #revealOverlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:9999999;background:#342018;cursor:pointer}
  #revealText{color:#fff;font-weight:700;font-size:clamp(20px,3.6vw,36px);letter-spacing:0.6px;text-transform:lowercase;user-select:none;animation: overlayPulse 1.6s ease-in-out infinite}
  @keyframes overlayPulse{0%{transform:translateY(0) scale(1)}50%{transform:translateY(-6px) scale(1.02)}100%{transform:translateY(0) scale(1)}}

  /* visual elements */
  .sun{position:absolute;top:-50px;left:-50px;width:260px;height:260px;border-radius:50%;background:radial-gradient(circle,#ff5533 0%,#ff7e5f 50%,rgba(255,126,95,0) 70%);filter:blur(20px);box-shadow:0 0 120px 40px var(--sun-glow);z-index:0;cursor:pointer;animation:sunMove 30s ease-in-out infinite}
  @keyframes sunMove{0%{top:-60px;left:-60px}50%{top:60px;left:-40px}75%{top:140px;left:-20px}100%{top:-60px;left:-60px}}
  .petal-wrap{position:absolute;top:0;left:0;pointer-events:auto;will-change:transform,opacity}
  .petal{display:inline-block;user-select:none;cursor:pointer;will-change:transform,opacity;text-shadow:0 2px 6px rgba(0,0,0,0.06)}
  @keyframes fallDown{0%{transform:translateY(-10vh)}100%{transform:translateY(120vh)}}
  @keyframes petalDrift{0%{transform:translateX(0) rotate(-8deg)}50%{transform:translateX(14px) rotate(6deg)}100%{transform:translateX(0) rotate(-8deg)}}
  .heart{position:absolute;cursor:pointer;user-select:none;animation:pop 1.4s ease forwards}
  @keyframes pop{0%{transform:scale(.6);opacity:0}50%{transform:scale(1.15);opacity:1}100%{transform:scale(.6);opacity:0}}
  .land{position:absolute;bottom:-40px;left:0;width:120%;height:200px;background:linear-gradient(to bottom,#3d1f1f 0%,#1a0f0f 80%);border-top-left-radius:50% 100px;border-top-right-radius:50% 100px;transform:translateX(-10%);z-index:5;box-shadow:0 -15px 25px rgba(0,0,0,0.4) inset}
  .tree-scene{position:absolute;bottom:100px;right:0;width:280px;height:280px;z-index:6;cursor:pointer}
  svg{width:100%;height:100%;fill:#1a0f16}
  .tree-top{transform-box:fill-box;transform-origin:75% 30%;animation:treeSway 6s ease-in-out infinite}
  @keyframes treeSway{0%,100%{transform:rotate(-2deg)}50%{transform:rotate(2deg)}}
  .swing{transform-box:fill-box;transform-origin:50% 0%;animation:swingMotion 4.2s ease-in-out infinite}
  @keyframes swingMotion{0%{transform:rotate(6deg)}50%{transform:rotate(-6deg)}100%{transform:rotate(6deg)}}

  .message{position:absolute;background:rgba(255,255,255,0.95);padding:8px 14px;border-radius:14px;font-weight:600;font-size:1rem;opacity:0;transform:translateY(12px) scale(.98);animation:floatFade 4s ease forwards;z-index:12;pointer-events:none;white-space:nowrap}
  @keyframes floatFade{0%{opacity:0;transform:translateY(12px) scale(.98)}10%{opacity:1;transform:translateY(0) scale(1)}70%{opacity:1;transform:translateY(-18px)}100%{opacity:0;transform:translateY(-50px)}}

  /* mini player */
  #miniPlayer{position:fixed;left:18px;bottom:18px;width:320px;max-width:92%;background:rgba(0,0,0,0.35);padding:12px;border-radius:12px;color:#fff;z-index:9999;backdrop-filter:blur(6px);box-shadow:0 10px 30px rgba(0,0,0,0.5);transition:transform .25s,opacity .25s;display:none}
  .close-btn{position:absolute;top:6px;right:8px;color:#fff;background:none;border:none;font-size:18px;cursor:pointer}
  .mini-disc{position:fixed;left:25px;bottom:25px;width:64px;height:64px;border-radius:50%;background-size:cover;background-position:center center;box-shadow:0 6px 20px rgba(0,0,0,0.45);cursor:pointer;z-index:99999;transition:transform .2s,opacity .2s}
  .mini-disc--ring{box-shadow:0 6px 20px rgba(0,0,0,0.45), 0 0 18px rgba(255,120,120,0.18)}
  .mini-disc.rotating{animation:spin 6s linear infinite}
  @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
  @media(max-width:420px){#miniPlayer{width:92%;left:8px;bottom:12px}}

  /* panels */
  .panel-root{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:100000;pointer-events:none}
  .panel{background:rgba(255,255,255,0.98);padding:20px 24px;border-radius:14px;box-shadow:0 18px 50px rgba(0,0,0,0.35);text-align:center;pointer-events:auto;max-width:92%;width:520px}
  .panel h2{font-size:1.4rem;margin-bottom:8px;color:#222;min-height:1.65em}
  .panel p{color:#444;margin-bottom:12px;min-height:1.3em}
  .choices{display:flex;gap:12px;justify-content:center;margin-top:6px}
  .btn{padding:10px 16px;border-radius:10px;border:none;font-weight:800;cursor:pointer;transition:transform .18s ease,box-shadow .18s ease}
  .btn-yes{background:linear-gradient(90deg,#ff7b7b,#ff4a8a);color:#fff;box-shadow:0 8px 22px rgba(255,80,120,0.18)}
  .btn-no{background:#eee;color:#222}
  .btn-name{background:#fff;color:#222;border:2px solid #efefef;padding:10px 12px}
  .small{font-size:.95rem}
  .confetti-heart{position:absolute;font-size:20px;opacity:0;animation:heartPop 1.2s ease forwards}
  @keyframes heartPop{0%{transform:translateY(0) scale(.6);opacity:0}40%{opacity:1;transform:translateY(-18px) scale(1.15)}100%{opacity:0;transform:translateY(-60px) scale(.8)}}

  /* typewriter caret */
  .typewriter.caret::after{
    content: '';
    display:inline-block;
    width:10px;
    height:1.2em;
    margin-left:6px;
    vertical-align:middle;
    background:linear-gradient(90deg,#222,#222);
    animation: blink 1s steps(2) infinite;
  }
  @keyframes blink{50%{opacity:0}}

  /* hide buttons until ready */
  .hidden{visibility:hidden;opacity:0;transform:translateY(6px);transition:all .24s ease}
  .visible{visibility:visible;opacity:1;transform:translateY(0);transition:all .28s cubic-bezier(.2,.9,.2,1)}
</style>
</head>
<body>

<!-- reveal overlay -->
<div id="revealOverlay" tabindex="0" role="button" aria-label="Click to reveal">
  <div id="revealText">click to enter...</div>
</div>

<!-- main stage -->
<div id="stage" class="blurred" aria-hidden="true">
  <div class="sun" id="sun" title="Click the sun"></div>
  <div class="land" aria-hidden="true"></div>

  <div class="tree-scene" id="treeScene" role="button" aria-label="Tree with swing">
    <svg viewBox="0 0 300 300" aria-hidden="true">
      <path d="M230 300 L250 160 L270 300 Z" fill="#1a0f16"/>
      <g class="tree-top">
        <circle cx="250" cy="140" r="60"/>
        <circle cx="220" cy="120" r="50"/>
        <circle cx="280" cy="120" r="50"/>
      </g>
      <path d="M200 150 C210 140, 240 135, 260 145" stroke="#1a0f16" stroke-width="6" fill="none" stroke-linecap="round"/>
      <line x1="200" y1="150" x2="200" y2="230" stroke="#1a0f16" stroke-width="3"/>
      <line x1="220" y1="150" x2="220" y2="230" stroke="#1a0f16" stroke-width="3"/>
      <g class="swing">
        <rect x="190" y="230" width="40" height="6" fill="#1a0f16"/>
        <circle cx="200" cy="220" r="6" fill="#1a0f16"/>
        <circle cx="215" cy="220" r="6" fill="#1a0f16"/>
      </g>
    </svg>
  </div>
</div>

<!-- music player -->
<div id="miniPlayer" aria-hidden="true">
  <button class="close-btn" id="closePlayer" aria-label="Minimize">×</button>
  <div id="mpControls">
    <div class="mp-title" id="mpTitle">Now playing — YouTube</div>
    <div class="mp-buttons">
      <button id="mpPlay" aria-label="Play">▶️</button>
      <button id="mpRew" title="Rewind 10s">⏪</button>
      <button id="mpFwd" title="Forward 10s">⏩</button>
    </div>
    <input type="range" id="mpProgress" min="0" max="100" value="0" aria-label="Progress">
    <div id="mpTime">0:00 / 0:00</div>
    <div style="margin-top:8px;">
      <label style="font-size:12px;color:#ffdede">Volume</label>
      <input type="range" id="mpVolume" min="0" max="1" step="0.01" value="0.6" aria-label="Volume">
    </div>
  </div>
</div>

<!-- panel root -->
<div id="panelRoot" class="panel-root" style="display:none;"></div>

<!-- YT container -->
<div id="yt-player-container" style="position:fixed;right:-9999px;bottom:-9999px;width:1px;height:1px;overflow:hidden;"></div>

<script>
/* ---------------- typewriter utility ---------------- */
function typeWrite(el, text, speed = 32) {
  return new Promise(resolve => {
    el.classList.add('typewriter','caret');
    el.textContent = '';
    let i = 0;
    function tick() {
      if (i < text.length) {
        el.textContent += text[i++];
        const delay = speed + Math.random()*Math.min(60, speed);
        setTimeout(tick, delay);
      } else {
        el.classList.remove('caret');
        resolve();
      }
    }
    tick();
  });
}

/* ---------------- petals & hearts ---------------- */
(function(){
  const stage = document.getElementById('stage');
  const numPetals = 40;
  for (let i=0;i<numPetals;i++){
    const w=document.createElement('div'); w.className='petal-wrap';
    const depth=Math.ceil(Math.random()*3);
    const size = depth===1 ? Math.random()*20+24 : depth===2 ? Math.random()*18+16 : Math.random()*14+10;
    const fall = depth===1 ? Math.random()*5+7 : depth===2 ? Math.random()*7+9 : Math.random()*9+11;
    w.style.left = Math.random()*100 + 'vw';
    w.style.top = Math.random()*-200 + 'px';
    w.style.animation = `fallDown ${fall}s linear infinite ${Math.random()*5}s`;
    w.style.zIndex = depth===1?9:depth===2?7:5;
    w.style.opacity = depth===1?0.95:depth===2?0.75:0.5;
    const p = document.createElement('div'); p.className='petal'; p.textContent='🌸'; p.style.fontSize=size+'px';
    p.style.animationDuration = (Math.random()*2+3).toFixed(2)+'s';
    w.appendChild(p); stage.appendChild(w);
  }
  function createHeart(){
    const h=document.createElement('div'); h.className='heart'; h.textContent='💗';
    h.style.left=(10+Math.random()*75)+'vw'; h.style.top=(30+Math.random()*50)+'vh';
    h.style.fontSize=(Math.random()*20+12)+'px'; h.style.zIndex=8;
    stage.appendChild(h); setTimeout(()=>h.remove(),2000);
  }
  setInterval(createHeart,700);
})();

/* ---------------- click messages ---------------- */
(function(){
  const stage = document.getElementById('stage');
  document.addEventListener('click', (e)=>{
    const petalWrap = e.target.closest('.petal-wrap');
    if (petalWrap && e.target.classList.contains('petal')){
      e.stopPropagation();
      const pastel = ['#ffb6c1','#ffc8dd','#cdb4db','#bde0fe','#a2d2ff','#fbc4ab','#ffafcc','#c8b6ff','#b5ead7','#fdfd96'];
      const color = pastel[Math.floor(Math.random()*pastel.length)];
      showMsg("You're cute as this flower :3", {color, box:`0 0 25px ${color}80`, anchorRect: petalWrap.getBoundingClientRect()});
      return;
    }
    if (e.target.classList.contains('heart')){
      e.stopPropagation();
      const texts=["You stole my heart ♥️","I love you 💝"]; const t=texts[Math.floor(Math.random()*texts.length)];
      const glow=['#ff66b2','#ff1493','#ff3366','#ff6f91','#ff85a1','#ff3f6e'][Math.floor(Math.random()*6)];
      showMsg(t,{color:glow, box:`0 0 30px ${glow}a0`, anchorRect: e.target.getBoundingClientRect()});
      return;
    }
  });
  document.getElementById('sun').addEventListener('click', (e)=>{ e.stopPropagation(); showMsg("Dayum, you're so hot 🥵, I'll get wet!", {color:'#ff3f6e', box:'0 0 30px rgba(255,90,120,0.6)', near: e.target.getBoundingClientRect()}); });
  function showMsg(text, opts={}){
    const m=document.createElement('div'); m.className='message'; m.textContent=text;
    if (opts.color) m.style.color=opts.color; if (opts.box) m.style.boxShadow=opts.box;
    if (opts.right!==undefined && opts.bottom!==undefined){ m.style.right=opts.right+'px'; m.style.bottom=opts.bottom+'px'; }
    else if (opts.anchorRect){ const r=opts.anchorRect; const left=r.left + r.width/2 - 80; const top=r.top - 48; m.style.left = Math.max(8, Math.min(left, window.innerWidth - 160)) + 'px'; m.style.top = Math.max(8, top) + 'px'; }
    else if (opts.near){ const r=opts.near; const left=r.right+8; const top=r.top + r.height/2 - 12; m.style.left = Math.max(8, Math.min(left, window.innerWidth - 200)) + 'px'; m.style.top = Math.max(8, Math.min(top, window.innerHeight - 80)) + 'px'; }
    else { m.style.left='20px'; m.style.top='20px'; }
    document.getElementById('stage').appendChild(m); setTimeout(()=>m.remove(),4200);
  }
})();

/* ---------------- YouTube player & mini-disc ---------------- */
(function(){
  const VIDEO_ID = 'HBxt_v0WF6Y'; // change as needed
  const playBtn = document.getElementById('mpPlay'), prog = document.getElementById('mpProgress'), vol = document.getElementById('mpVolume'), timeDisplay = document.getElementById('mpTime'), rew = document.getElementById('mpRew'), fwd = document.getElementById('mpFwd');
  const miniPlayer = document.getElementById('miniPlayer'), closeBtn = document.getElementById('closePlayer');
  const ytContainer = document.getElementById('yt-player-container');
  let ytPlayer=null, ytReady=false, progressInterval=null, disc=null;

  function fmt(s){ if(!s||isNaN(s)) return '0:00'; const m=Math.floor(s/60), sec=Math.floor(s%60); return m+':'+(sec<10?'0'+sec:sec); }
  function loadYT(cb){ if(window.YT && YT.Player){ cb(); return; } const s=document.createElement('script'); s.src='https://www.youtube.com/iframe_api'; document.head.appendChild(s); window.onYouTubeIframeAPIReady = cb; }
  function createYT(cb){
    const ph=document.createElement('div'); ph.id='ytplayer'; ytContainer.appendChild(ph);
    ytPlayer=new YT.Player('ytplayer',{height:'1',width:'1',videoId:VIDEO_ID,playerVars:{autoplay:0,controls:0,rel:0,modestbranding:1,playsinline:1,loop:1,playlist:VIDEO_ID},events:{onReady:()=>{ytReady=true; ytPlayer.setVolume(Math.round(parseFloat(vol.value)*100)); if(typeof cb==='function') cb();}, onStateChange:(ev)=>{ if(ev.data===1){ playBtn.textContent='⏸️'; if(disc) disc.classList.add('rotating'); startProgress(); } else if(ev.data===2||ev.data===0){ playBtn.textContent='▶️'; if(disc) disc.classList.remove('rotating'); stopProgress(); } } }});
  }
  function startProgress(){ stopProgress(); progressInterval=setInterval(()=>{ if(!ytReady||!ytPlayer) return; const cur=ytPlayer.getCurrentTime(), dur=ytPlayer.getDuration()||0; prog.value = dur? (cur/dur)*100 : 0; timeDisplay.textContent = fmt(cur) + ' / ' + fmt(dur); },300); }
  function stopProgress(){ if(progressInterval){ clearInterval(progressInterval); progressInterval=null; } }

  // expose init (called by reveal)
  window.initOnFirstClick = function(){
    if (ytPlayer || window._yt_init_started) return;
    window._yt_init_started = true;
    loadYT(function(){ createYT(function(){ try{ ytPlayer.playVideo(); }catch(e){} startProgress(); miniPlayer.style.display='block'; }); });
  };

  // controls
  playBtn && playBtn.addEventListener('click', ()=>{ if(!ytReady){ window.initOnFirstClick(); return; } const s=ytPlayer.getPlayerState(); if(s===1) ytPlayer.pauseVideo(); else ytPlayer.playVideo(); });
  rew && rew.addEventListener('click', ()=>{ if(!ytReady) return; ytPlayer.seekTo(Math.max(0, ytPlayer.getCurrentTime()-10), true); });
  fwd && fwd.addEventListener('click', ()=>{ if(!ytReady) return; ytPlayer.seekTo(Math.min(ytPlayer.getDuration()||0, ytPlayer.getCurrentTime()+10), true); });
  prog && prog.addEventListener('input', ()=> prog.dragging=true);
  prog && prog.addEventListener('change', ()=>{ if(!ytReady){ prog.dragging=false; return; } const t=(prog.value/100)*(ytPlayer.getDuration()||0); ytPlayer.seekTo(t,true); prog.dragging=false; });
  vol && vol.addEventListener('input', ()=>{ if(!ytReady) return; ytPlayer.setVolume(Math.round(parseFloat(vol.value)*100)); });

  closeBtn && closeBtn.addEventListener('click', ()=>{
    miniPlayer.style.opacity='0'; miniPlayer.style.transform='scale(0.92)';
    setTimeout(()=>{
      miniPlayer.style.display='none';
      if(!disc){
        disc=document.createElement('div'); disc.className='mini-disc mini-disc--ring';
        disc.style.backgroundImage = `url('https://img.youtube.com/vi/${VIDEO_ID}/hqdefault.jpg')`;
        document.body.appendChild(disc);
        disc.addEventListener('click', ()=>{ if(disc){ disc.remove(); disc=null; } miniPlayer.style.display='block'; setTimeout(()=>{ miniPlayer.style.opacity='1'; miniPlayer.style.transform='scale(1)'; },20); });
      }
      try{ if(ytReady && ytPlayer.getPlayerState && ytPlayer.getPlayerState()===1) disc.classList.add('rotating'); else disc.classList.remove('rotating'); }catch(e){}
    },200);
  });

  setInterval(()=>{ if(!disc) return; try{ if(ytReady && ytPlayer && typeof ytPlayer.getPlayerState==='function'){ const s=ytPlayer.getPlayerState(); if(s===1) disc.classList.add('rotating'); else disc.classList.remove('rotating'); } }catch(e){} },600);
  window.addEventListener('beforeunload', ()=>{ if(disc) try{ disc.remove(); }catch(e){} });
})();

/* ---------------- panels flow (with typewriter) ---------------- */
(function(){
  const panelRoot = document.getElementById('panelRoot');
  let chosenName = null;

  function createPanel(){
    panelRoot.innerHTML = '';
    const panel = document.createElement('div'); panel.className = 'panel';
    panelRoot.appendChild(panel);
    panelRoot.style.display = 'flex';
    return panel;
  }

  async function showNamePicker(){
    const panel = createPanel();
    panel.innerHTML = `<h2 id="nameHeading"></h2>
      <div class="choices small" id="nameButtons" style="margin-top:14px;">
        <button class="btn btn-name hidden" id="pickA">Répási Csenge Nadin</button>
        <button class="btn btn-name hidden" id="pickB">Ashley</button>
      </div>`;
    const nameHeading = panel.querySelector('#nameHeading');
    const pickA = panel.querySelector('#pickA');
    const pickB = panel.querySelector('#pickB');

    await typeWrite(nameHeading, "Hey, Répási Csenge Nadin or shall I say Ashley?");
    // reveal buttons
    pickA.classList.remove('hidden'); pickA.classList.add('visible');
    pickB.classList.remove('hidden'); pickB.classList.add('visible');

    pickA.addEventListener('click', ()=>{ chosenName = 'Répási Csenge Nadin'; proceedAfterName(); });
    pickB.addEventListener('click', ()=>{ chosenName = 'Ashley'; proceedAfterName(); });
  }

  async function proceedAfterName(){
    const panel = createPanel();
    panel.innerHTML = `<p id="loveLine" class="small"></p>`;
    const loveLine = panel.querySelector('#loveLine');
    // typed message
    await typeWrite(loveLine, "We have spent so many days together, lowkey feels unreal. I love you very much >_<! Sooooo...");
    // then show proposal after short delay
    setTimeout(()=> showProposal(), 800);
  }

  async function showProposal(){
    const panel = createPanel();
    panel.innerHTML = `<h2 id="proposalQ"></h2><p id="proposalP"></p>
      <div class="choices" id="proposalButtons" style="margin-top:14px;">
        <button class="btn btn-yes hidden" id="btnYes">yes</button>
        <button class="btn btn-no hidden" id="btnNo">no</button>
      </div>`;
    const q = panel.querySelector('#proposalQ');
    const p = panel.querySelector('#proposalP');
    const yes = panel.querySelector('#btnYes');
    const no = panel.querySelector('#btnNo');

    await typeWrite(q, "Will you marry me?");
    await typeWrite(p, "I want to spend the rest of my life with you.");
    // reveal buttons
    yes.classList.remove('hidden'); yes.classList.add('visible');
    no.classList.remove('hidden'); no.classList.add('visible');

    // No behavior
    let noClicks = 0;
    let yesScale = 1;
    yes.addEventListener('click', (e)=>{
      e.stopPropagation();
      const full = `${chosenName} Das`;
      panel.innerHTML = `<h2>You made Aniket's heart happy 💖</h2><p>and you have successfully become <strong>${full}</strong></p>`;
      spawnHearts(14);
      // keep final text visible for at least 7 seconds (7000 ms)
      setTimeout(()=> { if (panelRoot) panelRoot.remove(); }, 7000);
    });

    no.addEventListener('click', (e)=>{
      e.stopPropagation();
      noClicks++;
      yesScale *= 1.18;
      yes.style.transform = `scale(${yesScale})`;
      yes.style.boxShadow = '0 12px 30px rgba(255,80,140,0.18)';

      const panelRect = panel.getBoundingClientRect();
      const noRect = no.getBoundingClientRect();
      const cx = panelRect.left + panelRect.width/2;
      const cy = panelRect.top + panelRect.height/2;
      let dx = (noRect.left + noRect.width/2) - cx;
      let dy = (noRect.top + noRect.height/2) - cy;
      const len = Math.sqrt(dx*dx + dy*dy) || 1;
      dx /= len; dy /= len;
      const magnitude = 80 + noClicks * 90;
      const tx = dx * magnitude;
      const ty = dy * magnitude * 0.6;
      no.style.transition = 'transform 0.45s cubic-bezier(.2,.9,.2,1), opacity .4s';
      no.style.transform = `translate(${tx}px, ${ty}px)`;

      yes.style.transition = 'transform .18s';
      setTimeout(()=> yes.style.transform = `scale(${yesScale}) translateY(-6px)`, 120);
      setTimeout(()=> yes.style.transform = `scale(${yesScale}) translateY(0)`, 320);

      setTimeout(()=> {
        const nr = no.getBoundingClientRect();
        const offLeft = nr.right < 0;
        const offRight = nr.left > window.innerWidth;
        const offTop = nr.bottom < 0;
        const offBottom = nr.top > window.innerHeight;
        if (offLeft || offRight || offTop || offBottom){
          no.style.opacity = '0';
          no.style.pointerEvents = 'none';
        }
      }, 520);
    });
  }

  function spawnHearts(count){
    for(let i=0;i<count;i++){
      const h=document.createElement('div'); h.className='confetti-heart'; h.textContent='💗';
      h.style.left = (40 + Math.random()*30) + 'vw';
      h.style.top = (50 + Math.random()*10 - 40) + 'vh';
      h.style.fontSize = (14 + Math.random()*28) + 'px';
      document.body.appendChild(h);
      setTimeout(()=> h.remove(), 1700 + Math.random()*800);
    }
  }

  // expose
  window.showNamePicker = showNamePicker;
})();

/* ---------------- reveal overlay logic ---------------- */
(function(){
  const overlay = document.getElementById('revealOverlay');
  const stage = document.getElementById('stage');

  function reveal(){
    overlay.style.transition = 'opacity .28s ease';
    overlay.style.opacity = '0';
    setTimeout(()=> overlay.remove(), 320);
    stage.classList.remove('blurred');
    stage.setAttribute('aria-hidden','false');
    if (typeof window.initOnFirstClick === 'function') {
      try { window.initOnFirstClick(); } catch(e){}
    }
    setTimeout(()=> { if (typeof window.showNamePicker === 'function') window.showNamePicker(); }, 600);
  }

  overlay.addEventListener('click', reveal, { once:true });
  overlay.addEventListener('keydown', function(e){ if (e.key==='Enter' || e.key===' ') { reveal(); e.preventDefault(); } });
  overlay.setAttribute('tabindex','0');
})();
</script>
</body>
</html>
